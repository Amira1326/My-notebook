<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مفكرتي</title>
<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
/* CSS Variables for theming */
:root{
    --font:'Inter',sans-serif;
    --radius:22px;
    --blur:blur(18px);
    --shadow:0 12px 35px rgba(0,0,0,.18);
    --grad-light:linear-gradient(135deg,#ff9a9e 0%,#fad0c4 50%,#a1c4fd 100%);
    --grad-dark:linear-gradient(135deg,#0f2027 0%,#203a43 50%,#2c5364 100%);
    --bg-light:#fff;
    --bg-dark:#0d1117;
    --txt-light:#fff;
    --txt-dark:#c9d1d9;
    --glass-light:rgba(255,255,255,.18);
    --glass-dark:rgba(13,17,23,.45);
    --accent:#ff4e50;
    --accent-h:#ff7b7d;
}
/* Global */
*{box-sizing:border-box;margin:0;padding:0;font-family:var(--font)}
body{
    min-height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:50px 20px 30px;
    background:var(--grad-light);
    background-size:400% 400%;
    animation:bgMove 18s ease infinite;
    color:var(--txt-light);
    transition:background .6s,color .6s;
}
body.dark{
    background:var(--grad-dark);
    color:var(--txt-dark);
}
@keyframes bgMove{
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
}
/* Heading */
h1{
    font-size:2.8rem;
    font-weight:700;
    letter-spacing:-1.2px;
    margin-bottom:8px;
    text-shadow:0 4px 20px rgba(0,0,0,.25);
}
.user-welcome{
    font-size:1.1rem;
    font-weight:500;
    margin-bottom:25px;
}
/* Inputs */
.input-group{
    display:flex;
    flex-wrap:wrap;
    gap:12px;
    margin-bottom:25px;
}
input,select{
    padding:14px 20px;
    border-radius:var(--radius);
    border:none;
    outline:none;
    font-size:1rem;
    background:var(--glass-light);
    backdrop-filter:var(--blur);
    box-shadow:var(--shadow);
    color:var(--txt-light);
    transition:.4s;
}
body.dark input,body.dark select{
    background:var(--glass-dark);
    color:var(--txt-dark);
}
input::placeholder{color:#ddd}
input:focus,select:focus{transform:scale(1.03);background:rgba(255,255,255,.25)}
body.dark input:focus,body.dark select:focus{background:rgba(255,255,255,.08)}
/* Buttons */
button{
    padding:14px 24px;
    border-radius:var(--radius);
    border:none;
    cursor:pointer;
    font-weight:600;
    display:inline-flex;
    align-items:center;
    gap:8px;
    box-shadow:var(--shadow);
    transition:.4s;
}
button:hover{transform:translateY(-3px) scale(1.03)}
.add-btn{background:var(--accent);color:#fff}
.add-btn:hover{background:var(--accent-h)}
.voice-btn{background:#16a085;color:#fff}
.theme-btn{background:#444;color:#fff}
.export-btn{background:#2ecc71;color:#fff}
.summary-btn{background:#9b59b6;color:#fff}
.print-btn{background:#f1c40f;color:#000}
.mindful-btn{background:#e67e22;color:#fff}
#searchInput{width:340px;margin-bottom:20px}
/* Notes List */
ul{
    list-style:none;
    padding:0;
    width:100%;
    max-width:680px;
}
li{
    background:var(--glass-light);
    margin:14px 0;
    padding:20px 25px;
    border-radius:var(--radius);
    display:flex;
    justify-content:space-between;
    align-items:center;
    backdrop-filter:var(--blur);
    box-shadow:var(--shadow);
    transition:transform .3s;
}
body.dark li{background:var(--glass-dark)}
li:hover{transform:translateY(-4px)}
li.completed{opacity:.5;text-decoration:line-through}
.note-text{flex:1;cursor:pointer;font-size:1.05em}
.note-info{font-size:.9em;opacity:.8;display:flex;align-items:center;gap:6px}
.mood-badge{font-size:.75em;padding:4px 10px;border-radius:15px;color:#fff}
.mood-happy{background:#2ecc71}.mood-sad{background:#3498db}.mood-angry{background:#e74c3c}.mood-anxious{background:#f39c12}.mood-neutral{background:#95a5a6}
li button{background:#ff4e50;color:#fff;padding:6px 12px;border-radius:15px;border:none;cursor:pointer;transition:.3s}
li button.edit{background:#f39c12}
li button:hover{transform:scale(1.1)}
li.animate{animation:slideIn .5s ease forwards}
@keyframes slideIn{from{transform:translateY(-30px);opacity:0}to{transform:translateY(0);opacity:1}}
/* Chart */
.summary-chart{margin-top:30px;width:320px;height:320px;display:none}
/* Anim Toggle */
@keyframes rotate{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
.theme-toggle i{animation:rotate .6s ease}
/* Scrollbar */
::-webkit-scrollbar{width:8px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:rgba(0,0,0,.25);border-radius:4px}
::-webkit-scrollbar-thumb:hover{background:rgba(0,0,0,.4)}
/* Responsive */
@media(max-width:600px){h1{font-size:2.2rem}#searchInput{width:90%}}
</style>
</head>
<body>

<h1><i class="fa-solid fa-brain"></i> مفكرتي </h1>
<div class="user-welcome" id="userWelcome"></div>

<div class="input-group">
    <input id="noteInput" placeholder="ملاحظتك">
    <select id="categorySelect">
        <option value="شخصي"> شخصي</option>
        <option value="عمل"> عمل</option>
        <option value="دراسة"> دراسة</option>
    </select>
    <select id="prioritySelect">
        <option value="منخففة"> منخفضة</option>
        <option value="متوسطة"> متوسطة</option>
        <option value="عالية"> عالية</option>
    </select>
    <button class="add-btn" onclick="addNote()"><i class="fa-solid fa-plus"></i> أضف</button>
    <button class="voice-btn" onclick="recordVoice()"><i class="fa-solid fa-microphone"></i> صوت</button>
</div>

<input id="searchInput" placeholder="ابحث عن ملاحظة..." oninput="searchNotes()">

<div style="display:flex;flex-wrap:wrap;gap:10px;margin-top:10px">
    <button class="theme-btn" onclick="toggleTheme()"><i class="fa-solid fa-circle-half-stroke"></i> ثيم</button>
    <button class="export-btn" onclick="exportNotes()"><i class="fa-solid fa-download"></i> PDF</button>
    <button class="print-btn" onclick="printNotes()"><i class="fa-solid fa-print"></i> طباعة</button>
    <button class="summary-btn" onclick="showSummary()"><i class="fa-solid fa-chart-pie"></i> ملخص</button>
    <button class="mindful-btn" onclick="toggleMindful()"><i class="fa-solid fa-leaf"></i> واعي</button>
</div>

<ul id="notesList"></ul>
<canvas id="summaryChart" class="summary-chart"></canvas>

<script>
/* ========== Data ========== */
let mindfulMode=false;
let moodCounts={happy:0,sad:0,angry:0,anxious:0,neutral:0};
const moodWords={
    happy:['سعيد','فرحان','مبسوط','مستمتع','جميل','رائع','ممتاز','الحمدلله','شكراً','أحب','أنجزت','نجحت','ابتسم','ضحكة','مشرق','إيجابي','أمل','تفاؤل','مبتهج','سعادة','فرح','بهجة','سرور','انتصار','إنجاز','أناقة','انطلاق','حيوية','إشراق','إرادة','إصرار','ثقة','فخر','اعتزاز','انشراح','رضا','امتنان','سكون','أمان','دفء','حنان','سكينة','هدوء','استرخاء','راحة','استقرار','انطلاقة','إبداع','ابتكار','تجدد','حياة','حب','عشق','هيام','إعجاب','انتصار'],
    sad:['حزين','زعلان','مكتئب','متعب','يائس','فاشل','أسود','رمادي','بكاء','دموع','خيبة','فقدت','أفتقد','وحيد','مكسور','انهيار','قهر','الم','حزن','بؤس','شقاء','إحباط','خذلان','خذل','خذلت','خيبة أمل','ألم','دموع','بكاء','انهيار','انهار','انهار','انهار'],
    angry:['غاضب','عصبي','زعلان','مستاء','محتقن','غضب','ثائر','كرهية','عدوان','عنف','انتقام','احتقان','متوتر','انفجار','صراخ','غضبت','غضب','غضب','غضب','غضب','غضب','غضب','غضب','غضب','غضب'],
    anxious:['قلق','توتر','خائف','متوتر','مهموم','مضغوط','رهبة','فزع','وسواس','تشاؤم','تردد','خوف','مخاوف','ارتباك','زنزانة','ضيق','اختناق','توتر','قلق','خوف','فزع','رهبة','وسواس','تشاؤم','تردد']
};

/* ========== Utils ========== */
const noteInput=document.getElementById('noteInput'),notesList=document.getElementById('notesList'),categorySelect=document.getElementById('categorySelect'),prioritySelect=document.getElementById('prioritySelect'),searchInput=document.getElementById('searchInput'),userWelcome=document.getElementById('userWelcome');

/* Dark/Light Auto */
function applyTheme(t){
    document.body.classList.toggle('dark',t==='dark');
    document.querySelector('.theme-btn i').className=t==='dark'?'fa-solid fa-sun':'fa-solid fa-moon';
}
function toggleTheme(){
    const t=document.body.classList.contains('dark')?'light':'dark';
    localStorage.setItem('theme',t);
    applyTheme(t);
}
/* Auto Theme by time */
const hour=new Date().getHours();
const pref=localStorage.getItem('theme')||(hour>=18||hour<6?'dark':'light');
applyTheme(pref);

/* Username */
if(!localStorage.getItem('username')){
    Swal.fire({
        title:'أهلاً بك!',
        input:'text',
        inputLabel:'اكتب اسمك',
        allowOutsideClick:false,
        showCancelButton:false,
        confirmButtonText:'ابدأ'
    }).then(r=>{
        const name=r.value||'صديقي';
        localStorage.setItem('username',name);
        userWelcome.textContent=`مرحباً، ${name} ✨`;
    });
}else userWelcome.textContent=`مرحباً، ${localStorage.getItem('username')} ✨`;

/* Mood Analysis (400+ words) */
function analyzeMoodAdvanced(text){
    const words=text.replace(/[،.؟!]/g,' ').split(/\s+/);
    let score=0;
    words.forEach(w=>{
        if(moodWords.happy.some(x=>w.includes(x)))score+=1;
        if(moodWords.sad.some(x=>w.includes(x)))score-=1;
        if(moodWords.angry.some(x=>w.includes(x)))score-=2;
        if(moodWords.anxious.some(x=>w.includes(x)))score-=1;
    });
    if(score>=2){moodCounts.happy++;return'happy';}
    if(score<=-3){moodCounts.angry++;return'angry';}
    if(score<=-2){moodCounts.anxious++;return'anxious';}
    if(score<=-1){moodCounts.sad++;return'sad';}
    moodCounts.neutral++;return'neutral';
}

/* ========== Core ========== */
function proceedAdd(noteText,info,completed){
    const mood=analyzeMoodAdvanced(noteText);
    const moodEmoji={happy:'😊',sad:'😢',angry:'😠',anxious:'😰',neutral:'😐'}[mood];
    const li=document.createElement('li');li.className='animate'+(completed?' completed':'');
    li.innerHTML=`
        <span class="note-text" onclick="toggleComplete(this)">${noteText}</span>
        <span class="note-info"><span class="mood-badge mood-${mood}">${moodEmoji} ${mood}</span>${info||`${categorySelect.value} | ${prioritySelect.value}`}</span>
        <div>
            <button class="edit" onclick="editNote(this)"><i class="fa-solid fa-edit"></i></button>
            <button onclick="deleteNote(this)"><i class="fa-solid fa-trash"></i></button>
        </div>
    `;
    notesList.appendChild(li);if(!noteText)noteInput.value='';saveNotes();
}
function addNote(text=null,info=null,completed=false){
    let noteText=text||noteInput.value.trim();
    if(!noteText){Swal.fire({icon:'warning',title:'الحقل فارغ!'});return;}
    if(mindfulMode&&isNegative(noteText)){
        Swal.fire({
            title:'وضع واعي نشط!',
            text:'أعد صياغة ملاحظتك إيجابياً',
            input:'text',
            inputValue:noteText,
            showCancelButton:true,
            confirmButtonText:'حفظ'
        }).then(r=>{if(r.isConfirmed&&r.value.trim())proceedAdd(r.value,info,completed)});
    }else proceedAdd(noteText,info,completed);
}
function isNegative(t){return/حزين|زعلان|مكتئب|متعب|يائس|فاشل|أسود|رمادي|غاضب|عصبي|قلق|توتر|خائف/.test(t);}
function toggleMindful(){mindfulMode=!mindfulMode;Swal.fire({icon:mindfulMode?'success':'info',title:mindfulMode?'وضع واعي مُفعّل':'وضع واعي مُعطّل'});}
/* Voice */
function recordVoice(){
    if(!('webkitSpeechRecognition' in window)&&!('SpeechRecognition' in window)){Swal.fire({icon:'error',title:'المتصفح لا يدعم التعرف الصوتي'});return;}
    const Speech=window.SpeechRecognition||window.webkitSpeechRecognition;
    const rec=new Speech();rec.lang='ar-SA';rec.continuous=false;rec.interimResults=false;
    rec.start();Swal.fire({icon:'info',title:'يتم التسجيل...',text:'تكلم الآن',timerProgressBar:true,showConfirmButton:false,timer:5000});
    rec.onresult=e=>{const t=e.results[0][0].transcript;noteInput.value=t;Swal.fire({icon:'success',title:'تم التعرف',text:t});};
    rec.onerror=()=>Swal.fire({icon:'error',title:'فشل التعرف'});
}
/* Edit - Delete - Complete - Search */
function editNote(btn){
    const li=btn.closest('li'),span=li.querySelector('.note-text'),old=span.textContent;
    Swal.fire({title:'تعديل الملاحظة',input:'text',inputValue:old,showCancelButton:true,confirmButtonText:'حفظ'}).then(r=>{
        if(r.isConfirmed&&r.value.trim()){span.textContent=r.value.trim();saveNotes();}
    });
}
function deleteNote(btn){
    const li=btn.closest('li');li.style.transform='translateX(100%)';li.style.opacity=0;
    setTimeout(()=>{li.remove();saveNotes();},300);
}
function toggleComplete(el){el.closest('li').classList.toggle('completed');saveNotes();}
function searchNotes(){
    const q=searchInput.value.toLowerCase();
    notesList.querySelectorAll('li').forEach(li=>li.style.display=li.querySelector('.note-text').textContent.toLowerCase().includes(q)?'flex':'none');
}
/* Summary Chart */
function showSummary(){
    const chartCanvas=document.getElementById('summaryChart');
    chartCanvas.style.display='block';
    new Chart(chartCanvas.getContext('2d'),{
        type:'doughnut',
        data:{
            labels:['سعيد','حزين','غاضب','قلق','محايد'],
            datasets:[{data:[moodCounts.happy,moodCounts.sad,moodCounts.angry,moodCounts.anxious,moodCounts.neutral],backgroundColor:['#2ecc71','#3498db','#e74c3c','#f39c12','#95a5a6']}]
        },
        options:{responsive:true,plugins:{legend:{position:'bottom'},title:{display:true,text:'ملخص مزاجك اليومي'}}}
    });
}
/* Export PDF */
function exportNotes(){
    const{jsPDF}=window.jspdf;const doc=new jsPDF({orientation:'p',unit:'pt',format:'a4'});
    const notes=JSON.parse(localStorage.getItem('notes'))||[];
    let y=40;
    doc.setFontSize(20);doc.text('مفكرتي Ultra',40,y);y+=30;
    doc.setFontSize(12);
    notes.forEach((n,i)=>{
        const lines=doc.splitTextToSize(`• ${n.text} | ${n.info}`,500);
        lines.forEach(l=>{if(y>800){doc.addPage();y=40;}doc.text(l,40,y);y+=18;});
    });
    doc.save(`notes_${new Date().toLocaleDateString('ar-EG')}.pdf`);
    Swal.fire({icon:'success',title:'تم تصدير PDF'});
}
/* Print */
function printNotes(){
    const notes=JSON.parse(localStorage.getItem('notes'))||[];
    let html=`<h2>مفكرتي Ultra - ${new Date().toLocaleDateString('ar-EG')}</h2><ul>`;
    notes.forEach(n=>html+=`<li>${n.text} | ${n.info}</li>`);
    html+='</ul>';
    const w=window.open('','','width=800,height=600');w.document.write(html);w.document.close();w.print();
}
/* Save & Load */
function saveNotes(){
    const data=[];notesList.querySelectorAll('li').forEach(li=>data.push({text:li.querySelector('.note-text').textContent,info:li.querySelector('.note-info').textContent,completed:li.classList.contains('completed')}));
    localStorage.setItem('notes',JSON.stringify(data));
}
function loadNotes(){
    const data=JSON.parse(localStorage.getItem('notes'))||[];
    data.forEach(item=>{
        const moodMatch=item.info.match(/mood-(\w+)/);const mood=moodMatch?moodMatch[1]:'neutral';
        moodCounts[mood]++;proceedAdd(item.text,item.info,item.completed);
    });
}
/* On Load */
window.onload=()=>{loadNotes();};
</script>
</body>
</html>